<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Evaluation | NEON Ecological Forecasting Challenge</title>
  <meta name="description" content="Documentation for the NEON Ecological Forecasting Challenge" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Evaluation | NEON Ecological Forecasting Challenge" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://seankross.com/bookdown-start/" />
  
  <meta property="og:description" content="Documentation for the NEON Ecological Forecasting Challenge" />
  <meta name="github-repo" content="eco4cast/neon4cast-docs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Evaluation | NEON Ecological Forecasting Challenge" />
  
  <meta name="twitter:description" content="Documentation for the NEON Ecological Forecasting Challenge" />
  

<meta name="author" content="Ecological Forecasting Initative Research Coordination Network" />


<meta name="date" content="2021-04-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="shared-forecast-drivers.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">NEON Ecological Forecasting Challenge</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html"><i class="fa fa-check"></i><b>1</b> Theme: Aquatic Ecosystems</a>
<ul>
<li class="chapter" data-level="1.1" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#challenge"><i class="fa fa-check"></i><b>1.2</b> Challenge</a></li>
<li class="chapter" data-level="1.3" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#data-training-and-evaluation"><i class="fa fa-check"></i><b>1.3</b> Data: Training and Evaluation</a></li>
<li class="chapter" data-level="1.4" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#data-targets"><i class="fa fa-check"></i><b>1.4</b> Data: Targets</a></li>
<li class="chapter" data-level="1.5" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#detailed-protocol"><i class="fa fa-check"></i><b>1.5</b> Detailed Protocol</a></li>
<li class="chapter" data-level="1.6" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#timeline"><i class="fa fa-check"></i><b>1.6</b> Timeline</a></li>
<li class="chapter" data-level="1.7" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#design-team"><i class="fa fa-check"></i><b>1.7</b> Design Team</a></li>
<li class="chapter" data-level="1.8" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#partners"><i class="fa fa-check"></i><b>1.8</b> Partners</a></li>
<li class="chapter" data-level="1.9" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#details"><i class="fa fa-check"></i><b>1.9</b> Details</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#focal-variables"><i class="fa fa-check"></i><b>1.9.1</b> Focal variables</a></li>
<li class="chapter" data-level="1.9.2" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#focal-sites"><i class="fa fa-check"></i><b>1.9.2</b> Focal sites</a></li>
</ul></li>
<li class="chapter" data-level="1.10" data-path="theme-aquatic-ecosystems.html"><a href="theme-aquatic-ecosystems.html#references"><i class="fa fa-check"></i><b>1.10</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="participation.html"><a href="participation.html"><i class="fa fa-check"></i><b>2</b> Participation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="participation.html"><a href="participation.html#participation-guidance"><i class="fa fa-check"></i><b>2.1</b> Participation guidance</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="participation.html"><a href="participation.html#how-to-participate"><i class="fa fa-check"></i><b>2.1.1</b> HOW TO PARTICIPATE:</a></li>
<li class="chapter" data-level="2.1.2" data-path="participation.html"><a href="participation.html#teams"><i class="fa fa-check"></i><b>2.1.2</b> TEAMS:</a></li>
<li class="chapter" data-level="2.1.3" data-path="participation.html"><a href="participation.html#slack-and-github-communication"><i class="fa fa-check"></i><b>2.1.3</b> SLACK AND GITHUB COMMUNICATION</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="participation.html"><a href="participation.html#submission-instructions"><i class="fa fa-check"></i><b>2.2</b> Submission instructions</a></li>
<li class="chapter" data-level="2.3" data-path="participation.html"><a href="participation.html#participation-agreement"><i class="fa fa-check"></i><b>2.3</b> Participation agreement</a></li>
<li class="chapter" data-level="2.4" data-path="participation.html"><a href="participation.html#neon-data-use"><i class="fa fa-check"></i><b>2.4</b> NEON Data Use</a></li>
<li class="chapter" data-level="2.5" data-path="participation.html"><a href="participation.html#additional-data-options"><i class="fa fa-check"></i><b>2.5</b> Additional data options</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="shared-forecast-drivers.html"><a href="shared-forecast-drivers.html"><i class="fa fa-check"></i><b>3</b> Shared Forecast Drivers</a>
<ul>
<li class="chapter" data-level="3.1" data-path="shared-forecast-drivers.html"><a href="shared-forecast-drivers.html#meteorology-noaa-global-ensemble-forecasting-system"><i class="fa fa-check"></i><b>3.1</b> Meteorology: NOAA Global Ensemble Forecasting System</a></li>
<li class="chapter" data-level="3.2" data-path="shared-forecast-drivers.html"><a href="shared-forecast-drivers.html#meteorology-neon-observed"><i class="fa fa-check"></i><b>3.2</b> Meteorology: NEON Observed</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>4</b> Evaluation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="evaluation.html"><a href="evaluation.html#results"><i class="fa fa-check"></i><b>4.1</b> Results</a></li>
<li class="chapter" data-level="4.2" data-path="evaluation.html"><a href="evaluation.html#scoring-metric-continuous-ranked-probability-score"><i class="fa fa-check"></i><b>4.2</b> Scoring Metric: Continuous Ranked Probability Score</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="evaluation.html"><a href="evaluation.html#example-of-a-crps-calculation-from-an-ensemble-forecast"><i class="fa fa-check"></i><b>4.2.1</b> Example of a CRPS calculation from an ensemble forecast</a></li>
<li class="chapter" data-level="4.2.2" data-path="evaluation.html"><a href="evaluation.html#exploring-the-scoring-surface"><i class="fa fa-check"></i><b>4.2.2</b> Exploring the scoring surface</a></li>
<li class="chapter" data-level="4.2.3" data-path="evaluation.html"><a href="evaluation.html#crps-from-the-normal-distribution"><i class="fa fa-check"></i><b>4.2.3</b> CRPS from the Normal Distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="evaluation.html"><a href="evaluation.html#null-forecast"><i class="fa fa-check"></i><b>4.3</b> Null forecast</a></li>
<li class="chapter" data-level="4.4" data-path="evaluation.html"><a href="evaluation.html#forecast-submission-visualization-and-leaderboard"><i class="fa fa-check"></i><b>4.4</b> Forecast Submission Visualization and Leaderboard</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NEON Ecological Forecasting Challenge</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="evaluation" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Evaluation</h1>
<p>Forecasts will be evaluated at each site and forecast horizon (i.e., time-step into the future), and a summary score will be assigned evaluating overall performance of all forecast submissions across sites. Forecasts will also be compared to a null model.</p>
<p>Forecast evaluation results will be presented for all submitted models together and separately for each team category: undergraduate student only team, graduate student only team, post-doc only team, single institution team, multi-institution team, international team (team with individuals from at least two countries).</p>
<div id="results" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Results</h2>
<p>Preliminary results will be distributed using the NEON Ecological Forecast Challenge Output RShiny app and at <a href="https://data.ecoforecast.org/minio/scores/" class="uri">https://data.ecoforecast.org/minio/scores/</a>. We intend to write a joint manuscript synthesizing forecasts. Teams are welcome to publish results from their model at any time. If a publication is generated we encourage the manuscript to acknowledge the Ecological Forecasting Research Coordination Network and its support from the National Science Foundation (DEB-1926388).</p>
</div>
<div id="scoring-metric-continuous-ranked-probability-score" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Scoring Metric: Continuous Ranked Probability Score</h2>
<p>Forecasts will be scored using the continuous ranked probability score (CRPS), a proper scoring rule for evaluating forecasts presented as distributions or ensembles (Gneiting &amp; Raftery 2007). The CRPS compares the forecast probability distribution to that of the validation observation and assigns a score based on both the accuracy and precision of the forecast. We will use the ‘crps_sample’ function from the <code>scoringRules</code> package in R to calculate the CRPS for each forecast.</p>
<p>We will generate a combined score for all locations and forecast horizons. Forecasts will also be evaluated using the CRPS at each time-step in the forecast horizon and each location included in the forecasts.</p>
<div id="example-of-a-crps-calculation-from-an-ensemble-forecast" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Example of a CRPS calculation from an ensemble forecast</h3>
<p>The following uses Equation 2 in Jordan, Kruger, and Lerch 2018</p>
<div class="figure">
<img src="images/equation_2.png" alt="" />
<p class="caption">Equation 1 from Jordan, Kruger, and Lerch 2018.</p>
</div>
<p>First, create a random sample from a probability distribution. This is the “forecast” for a particular point in time. For simplicity, we will use a normal distribution with a mean of 8 and standard deviation of 1</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="evaluation.html#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.0</span>)</span></code></pre></div>
<p>Second, we have our data point (i.e., the target). We will set it to zero as well</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="evaluation.html#cb2-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">8</span></span></code></pre></div>
<p>Now calculate CRPS using Equation 2</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="evaluation.html#cb3-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-2"><a href="evaluation.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)){</span>
<span id="cb3-3"><a href="evaluation.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)){</span>
<span id="cb3-4"><a href="evaluation.html#cb3-4" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> s <span class="sc">+</span> <span class="fu">abs</span>(x[i] <span class="sc">-</span> x[j])</span>
<span id="cb3-5"><a href="evaluation.html#cb3-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-6"><a href="evaluation.html#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="evaluation.html#cb3-7" aria-hidden="true" tabindex="-1"></a>crps_equation_2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(x <span class="sc">-</span> y)) <span class="sc">-</span> s <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(x)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb3-8"><a href="evaluation.html#cb3-8" aria-hidden="true" tabindex="-1"></a>crps_equation_2</span></code></pre></div>
<pre><code>## [1] 0.2337715</code></pre>
<p>Now calculate using the <code>crps_sample()</code> function in the <code>scoringRules</code> package</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="evaluation.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crps_sample</span>(<span class="at">y =</span> y, <span class="at">dat =</span> x)</span></code></pre></div>
<pre><code>## [1] 0.2337715</code></pre>
</div>
<div id="exploring-the-scoring-surface" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Exploring the scoring surface</h3>
<p>Now lets see how the CRPS changes as the mean and standard deviation of the forecasted distribution change</p>
<p>First, set vectors for the different mean and SD values we want to explore</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="evaluation.html#cb7-1" aria-hidden="true" tabindex="-1"></a>sample_mean <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">4</span>, <span class="dv">12</span>, <span class="fl">0.1</span>)</span>
<span id="cb7-2"><a href="evaluation.html#cb7-2" aria-hidden="true" tabindex="-1"></a>sample_sd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)</span></code></pre></div>
<p>Second, set our observed value to 8 for simplicity</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="evaluation.html#cb8-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">8</span></span></code></pre></div>
<p>Now calculate the CRPS at each combination of forest mean and SD</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="evaluation.html#cb9-1" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(sample_mean), <span class="fu">length</span>(sample_sd)))</span>
<span id="cb9-2"><a href="evaluation.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sample_mean)){</span>
<span id="cb9-3"><a href="evaluation.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sample_sd)){</span>
<span id="cb9-4"><a href="evaluation.html#cb9-4" aria-hidden="true" tabindex="-1"></a>    sample <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, sample_mean[i], sample_sd[j])</span>
<span id="cb9-5"><a href="evaluation.html#cb9-5" aria-hidden="true" tabindex="-1"></a>    combined[i, j] <span class="ot">&lt;-</span> <span class="fu">crps_sample</span>(<span class="at">y =</span> y, <span class="at">dat =</span> sample)</span>
<span id="cb9-6"><a href="evaluation.html#cb9-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-7"><a href="evaluation.html#cb9-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, visualize the scoring surface with the observed value represented by the red line</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="evaluation.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> sample_mean, <span class="at">y =</span> sample_sd, <span class="at">z =</span> <span class="fu">as.matrix</span>(combined),<span class="at">nlevels =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">&quot;Mean&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SD&quot;</span>)</span>
<span id="cb10-2"><a href="evaluation.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> y, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="04-Evaluation_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The contour surface highlights the trade-off between the mean and standard deviation.</p>
</div>
<div id="crps-from-the-normal-distribution" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> CRPS from the Normal Distribution</h3>
<p>If the distributional forecast is a normal distribution represented by a mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma\)</span>, an ensemble of predictions is not needed to evaluate CRPS because we can take advantage of the analytic solution to CRPS under the normal assumption (Equation 4 from <a href="https://doi.org/10.1175/MWR2904.1">Calibrated Probabilistic Forecasting Using Ensemble Model Output Statistics and Minimum CRPS Estimation</a>).</p>
<p>Equation 5 from <a href="https://doi.org/10.1175/MWR2904.1">Calibrated Probabilistic Forecasting Using Ensemble Model Output Statistics and Minimum CRPS Estimation</a> gives</p>
<p><span class="math display">\[\begin{align*}
CRPS(N(\mu, \sigma^2) | y) = \sigma \left( \frac{y - \mu}{\sigma} \left( 2 \Phi\left(  \frac{y - \mu}{\sigma} \right) - 1 \right)  + 2 \phi \left(  \frac{y - \mu}{\sigma} \right) - \frac{1}{\sqrt{\pi}} \right)
\end{align*}\]</span></p>
<p>for <span class="math inline">\(\Phi(\cdot)\)</span> and <span class="math inline">\(\phi(\cdot)\)</span> the standard normal CDF and PDF, respectively. Therefore, if the forecast distribution is <strong>truly</strong> a normal distribution (often this isn’t true in forecasts that only report a mean and sd) a simplified score can be applied as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="evaluation.html#cb11-1" aria-hidden="true" tabindex="-1"></a>sample_mean <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">4</span>, <span class="dv">12</span>, <span class="fl">0.1</span>)</span>
<span id="cb11-2"><a href="evaluation.html#cb11-2" aria-hidden="true" tabindex="-1"></a>sample_sd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)</span>
<span id="cb11-3"><a href="evaluation.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="evaluation.html#cb11-4" aria-hidden="true" tabindex="-1"></a>combined_norm <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(sample_mean), <span class="fu">length</span>(sample_sd)))</span>
<span id="cb11-5"><a href="evaluation.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sample_mean)){</span>
<span id="cb11-6"><a href="evaluation.html#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sample_sd)){</span>
<span id="cb11-7"><a href="evaluation.html#cb11-7" aria-hidden="true" tabindex="-1"></a>    combined_norm[i, j] <span class="ot">&lt;-</span> <span class="fu">crps_norm</span>(<span class="at">y =</span> y, <span class="at">mean =</span> sample_mean[i], <span class="at">sd =</span> sample_sd[j])</span>
<span id="cb11-8"><a href="evaluation.html#cb11-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-9"><a href="evaluation.html#cb11-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, visualize the scoring surface with the observed value represented by
the red line</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="evaluation.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> sample_mean, <span class="at">y =</span> sample_sd, <span class="at">z =</span> <span class="fu">as.matrix</span>(combined_norm), <span class="at">nlevels =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">&quot;Mean&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SD&quot;</span>)</span>
<span id="cb12-2"><a href="evaluation.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> y, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="04-Evaluation_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Note that at a given value of the sd, the lowest score is achieved at <span class="math inline">\(\mu = y\)</span> as shown for each of the blue lines where the minmum value of the score across each blue line is at the red line. This behavior make sense because the CRPS is a score that reward accuracy and precision. Thus, for any given level of precision (represented by the standard deviation), CRPS is optimized by producing the most accurate prediction of the distribution’s location.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="evaluation.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> sample_mean, <span class="at">y =</span> sample_sd, <span class="at">z =</span> <span class="fu">as.matrix</span>(combined_norm), <span class="at">nlevels =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">&quot;Mean&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SD&quot;</span>)</span>
<span id="cb13-2"><a href="evaluation.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> y, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb13-3"><a href="evaluation.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">2.5</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb13-4"><a href="evaluation.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">4.3</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb13-5"><a href="evaluation.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">6.8</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="04-Evaluation_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Interestingly, for a given mean <span class="math inline">\(\mu \neq y\)</span> we find a pattern that makes intuitive sense given the goal of CRPS to produce forecasts that are both accurate and precise. For a given amount of bias in the prediction (i.e., given a <span class="math inline">\(\mu \neq y\)</span>), the optimal score is achieved by a standard deviation that slightly larger than the bias</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="evaluation.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span>
<span id="cb14-2"><a href="evaluation.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## plots for mu = 7</span></span>
<span id="cb14-3"><a href="evaluation.html#cb14-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb14-4"><a href="evaluation.html#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> sample_mean, <span class="at">y =</span> sample_sd, <span class="at">z =</span> <span class="fu">as.matrix</span>(combined_norm), <span class="at">nlevels =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">&quot;Mean&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SD&quot;</span>, <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">&quot;CRPS contour given mu = &quot;</span>, mu))</span>
<span id="cb14-5"><a href="evaluation.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> mu, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb14-6"><a href="evaluation.html#cb14-6" aria-hidden="true" tabindex="-1"></a>min_sd <span class="ot">&lt;-</span> sample_sd[<span class="fu">which.min</span>(<span class="fu">crps_norm</span>(y, <span class="at">mean =</span> mu, <span class="at">sd =</span> sample_sd))]</span>
<span id="cb14-7"><a href="evaluation.html#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> min_sd, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb14-8"><a href="evaluation.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sample_sd, <span class="fu">crps_norm</span>(y, <span class="at">mean =</span> mu, <span class="at">sd =</span> sample_sd), <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">&quot;CRPS profile given mu = &quot;</span>, mu))</span>
<span id="cb14-9"><a href="evaluation.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> min_sd, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb14-10"><a href="evaluation.html#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="do">## plots for mu = 11</span></span>
<span id="cb14-11"><a href="evaluation.html#cb14-11" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb14-12"><a href="evaluation.html#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> sample_mean, <span class="at">y =</span> sample_sd, <span class="at">z =</span> <span class="fu">as.matrix</span>(combined_norm), <span class="at">nlevels =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">&quot;Mean&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SD&quot;</span>, <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">&quot;CRPS contour given mu = &quot;</span>, mu))</span>
<span id="cb14-13"><a href="evaluation.html#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> mu, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb14-14"><a href="evaluation.html#cb14-14" aria-hidden="true" tabindex="-1"></a>min_sd <span class="ot">&lt;-</span> sample_sd[<span class="fu">which.min</span>(<span class="fu">crps_norm</span>(y, <span class="at">mean =</span> mu, <span class="at">sd =</span> sample_sd))]</span>
<span id="cb14-15"><a href="evaluation.html#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> min_sd, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb14-16"><a href="evaluation.html#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sample_sd, <span class="fu">crps_norm</span>(y, <span class="at">mean =</span> mu, <span class="at">sd =</span> sample_sd), <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">&quot;CRPS profile given mu = &quot;</span>, mu))</span>
<span id="cb14-17"><a href="evaluation.html#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> min_sd, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="04-Evaluation_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Next, we plot the relationship between a given value of <span class="math inline">\(\mu\)</span> and the <span class="math inline">\(\sigma\)</span> that produces the optimal CRPS. This looks like a linear relationship.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="evaluation.html#cb15-1" aria-hidden="true" tabindex="-1"></a>optimal_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(sample_mean))</span>
<span id="cb15-2"><a href="evaluation.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sample_mean)) {</span>
<span id="cb15-3"><a href="evaluation.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  optimal_sd[i] <span class="ot">&lt;-</span> sample_sd[<span class="fu">which.min</span>(<span class="fu">crps_norm</span>(y, <span class="at">mean =</span> sample_mean[i], <span class="at">sd =</span> sample_sd))]</span>
<span id="cb15-4"><a href="evaluation.html#cb15-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-5"><a href="evaluation.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sample_mean, optimal_sd, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>)</span></code></pre></div>
<p><img src="04-Evaluation_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Let’s estimate the slope of the relationship. It looks like the optimal <span class="math inline">\(sd\)</span> for a normal distribution forecast that is biased by <span class="math inline">\(|y - \mu|\)</span> is <span class="math inline">\(sd = 1.2|y - \mu|\)</span> which makes sense as this would put the true value in a region of high probability.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="evaluation.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(optimal_sd[sample_mean <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="sc">~</span> sample_mean[sample_mean <span class="sc">&gt;</span> <span class="dv">0</span>]))</span></code></pre></div>
<pre><code>##                  (Intercept) sample_mean[sample_mean &gt; 0] 
##                 2.430864e+00                -1.688326e-16</code></pre>
</div>
</div>
<div id="null-forecast" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Null forecast</h2>
<p>All forecasts will be compared to a null forecast produced by a simple historical-means calculation or a random walk. The GitHub repository for each theme has the code for the null model.</p>
</div>
<div id="forecast-submission-visualization-and-leaderboard" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Forecast Submission Visualization and Leaderboard</h2>
<p>The <a href="https://shiny.ecoforecast.org">dashboard</a> shows the forecast submissions by each team for each forecast theme by date and forecast variable. It also provides the CRPS scores for each submitted forecast.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="shared-forecast-drivers.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
